<?php
/**
 * @category   Asm
 * @package    Asm_Search
 * @author     sunilnalawade15@gmail.com
 * @copyright  This file was generated by using Module Creator(http://code.vky.co.in/magento-2-module-creator/) provided by VKY <viky.031290@gmail.com>
 * @license    http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */
$collecion = $block->searchResult();
//print_r($collecion->getData());
$image = 'category_page_grid';
$_helper = $this->helper('Magento\Catalog\Helper\Output');
$templateType = \Magento\Catalog\Block\Product\ReviewRendererInterface::SHORT_VIEW;

$objectManager = \Magento\Framework\App\ObjectManager::getInstance();
$store = $objectManager->get('Magento\Store\Model\StoreManagerInterface')->getStore();
//print_r($collecion->getData());
?>
<!-- <script src="http://maps.google.com/maps/api/js?key=AIzaSyA2bRGYQUYqiVZj4SBYAjWvx-3eVqW3Yh4&sensor=false"></script> -->
<!-- <script src="http://maps.google.com/maps/api/js?key=AIzaSyCoLbQMJVrWfwYGdNOWxOVz3NMzYjCRhQg&libraries=places&callback=initAutocomplete"></script> -->
<form class="" action="" id="asm-search-form" method="post" data-mage-init='{"validation": {}}'>
    <fieldset class="fieldset">
        <legend class="legend"><span>Product Search </legend><br>
        <div class="field note no-label">Write here anything you want.</div>
        <div class="field title">
            <label class="label" for="title"><span>Search</span></label>
            <div class="control">
                <input name="title" id="title" title="Search" class="input-text" type="text" data-validate="{required:true}" value="<?php echo $block->searchTeam(); ?>">
                <input type="hidden" id="lat" name="lat" title="Lat" value=""/>
			    <input type="hidden" id="lng" name="lng" title="Lng" value=""/>
			</div>
        </div>
    </fieldset>
    <div class="actions-toolbar">
        <div class="primary">
            <button type="submit" title="Submit" class="action submit primary">
                <span>Submit</span>
            </button>
        </div>
    </div>
</form>

<div id="popup-modal" class="modal fade" >
    <div id="locationField">
      <input id="autocomplete" placeholder="Enter your address"
             type="text"/>
    </div>
</div>

<!-- Search result text -->
<?php if($block->searchTeam()): ?>
  <div id="asm-search-result" class="products wrapper grid products-grid">
    <div data-bind="attr: {
        class: 'message-' + message.type + ' ' + message.type + ' message',
        'data-ui-id': 'message-' + message.type
    }" class="message-notice notice message" data-ui-id="message-notice">
        <div data-bind="html: message.text">Search results for:<?php echo ' "'.$block->searchTeam().'"' ?></div>
    </div>
  </div>
<?php endif; ?>
<?php if($collecion): if(!empty($collecion->getData())){ ?>
<!-- Show search result -->
<div id="asm-search-result" class="products wrapper grid products-grid">
    <?php $iterator = 1; ?>
    <ol class="products list items product-items">
        <?php foreach ($collecion as $_product): ?>
        <?= /* @escapeNotVerified */ ($iterator++ == 1) ? '<li class="item product product-item">' : '</li><li class="item product product-item">' ?>
            <div class="product-item-info" style="width:207px">
                <?php // Product Image ?>
                <a href="<?= /* @escapeNotVerified */ $_product->getProductUrl() ?>" class="product photo product-item-photo">
                    <span class="product-image-container" style="width:240px;">
                        <span class="product-image-wrapper" style="padding-bottom: 125%;">
                          <?php $imageUrl = $store->getBaseUrl(\Magento\Framework\UrlInterface::URL_TYPE_MEDIA) . 'catalog/product' . $_product->getImage(); ?>
                            <img class="product-image-photo" src="<?php echo $imageUrl ?>" alt="MAGGI Noodles - Masala, 6x70 gm Multi Pack" width="240" height="300"></span>
                    </span>
                </a>
                <div class="product-item-details">
                <?php

                    $info = [];
                    $info['name'] = '<strong class="product name product-item-name">'
                                    . ' <a class="product-item-link" href="' . $_product->getProductUrl() . '" title="'
                                    . $block->stripTags($_product->getName(), null, true) . '">'
                                    . $_helper->productAttribute($_product, $_product->getName(), 'name')
                                    . '</a></strong>';
                    $info['price'] = '<div class="price-box price-final_price" data-role="priceBox" data-product-id="2" data-price-box="product-id-2">  
                                      <span class="price-container price-final_price tax weee">
                                      <span id="product-price-2" data-price-amount="'.round($_product->getPrice(),2).'" data-price-type="finalPrice" class="price-wrapper "><span class="price">â‚¹'.round($_product->getPrice(),2).'</span></span>
                                      </span>
                                      </div>';
                    $info['review'] = $block->getReviewsSummaryHtml($_product, $templateType);

                    if ($_product->isSaleable()) {
                        $info['button'] = '<div class="actions-primary"><button type="button" title="' . __('Add to Cart') . '" class="action tocart"'
                                        . ' data-mage-init=\'{ "redirectUrl": { "event": "click", url: "' . $block->getAddToCartUrl($_product) . '"} }\'>'
                                        . '<span>' . __('Add to Cart') . '</span></button></div>';
                    } else {
                        $info['button'] = $_product->getIsSalable() ?   '<div class="stock available"><span>' . __('In stock') . '</span></div>' :
                                                                        '<div class="stock unavailable"><span>' . __('Out of stock') . '</span></div>';
                    }

                    $info['links'] = '<div class="actions-secondary" data-role="add-to-links">'
                                    . '<a href="#" data-post=\'' . $this->helper('Magento\Wishlist\Helper\Data')->getAddParams($_product) . '\' class="action towishlist" data-action="add-to-wishlist">'
                                    . '<span>' . __('Add to Wish List') . '</span></a>'
                                    . '<a href="' . $block->getAddToCompareUrl($_product) . '" class="action tocompare">'
                                    . '<span>' . __('Add to Compare') . '</span></a></div>';
                    $info['actions'] = '<div class="product-item-inner"><div class="product action product-item-actions">' . $info['button'] . $info['links'] . '</div></div>';

                  // $info['description'] =  '<div class="product description">'
                                              //  . $_helper->productAttribute($_product, $_product->getShortDescription(), 'short_description')
                                               // . ' <a href="' . $_product->getProductUrl() . '" class="action more">'
                                                //. __('Learn More') . '</a></div>';
                   
                    $details = $block->getInfoOrder() ?: ['name','price','review','actions'];
                    foreach ($details as $detail) {
                        /* @escapeNotVerified */ echo $info[$detail];
                    }
                    ?>

                </div>
            </div>
        <?= ($iterator == count($collecion)+1) ? '</li>' : '' ?>
        <?php endforeach; ?>
    </ol>
</div>
<?php }else{ ?>
    <div id="asm-search-result" class="products wrapper grid products-grid">
        <div data-bind="attr: {
            class: 'message-' + message.type + ' ' + message.type + ' message',
            'data-ui-id': 'message-' + message.type
        }" class="message-notice notice message" data-ui-id="message-notice">
            <div data-bind="html: message.text">We can't find products matching the selection.</div>
        </div>
    </div>
<?php }  endif; ?>

<script>

      var placeSearch, autocomplete;
      var componentForm = {
        street_number: 'short_name',
        route: 'long_name',
        locality: 'long_name',
        administrative_area_level_1: 'short_name',
        country: 'long_name',
        postal_code: 'short_name'
      };

      function initAutocomplete() {
        // Create the autocomplete object, restricting the search to geographical
        // location types.
        autocomplete = new google.maps.places.Autocomplete(
            /** @type {!HTMLInputElement} */(document.getElementById('autocomplete')),
            {types: ['geocode']});

        // When the user selects an address from the dropdown, populate the address
        // fields in the form.
        autocomplete.addListener('place_changed', fillInAddress);
      }

      function fillInAddress() {
        // Get the place details from the autocomplete object.
        var place = autocomplete.getPlace();

        for (var component in componentForm) {
          document.getElementById(component).value = '';
          document.getElementById(component).disabled = false;
        }

        // Get each component of the address from the place details
        // and fill the corresponding field on the form.
        for (var i = 0; i < place.address_components.length; i++) {
          var addressType = place.address_components[i].types[0];
          if (componentForm[addressType]) {
            var val = place.address_components[i][componentForm[addressType]];
            document.getElementById(addressType).value = val;
          }
        }
      }
      
      
       
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCoLbQMJVrWfwYGdNOWxOVz3NMzYjCRhQg&libraries=places&callback=initAutocomplete"
        async defer></script>